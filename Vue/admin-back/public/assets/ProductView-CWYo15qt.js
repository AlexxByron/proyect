var st=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var P=(e,t,r)=>(st(e,t,"read from private field"),r?r.call(e):t.get(e)),pe=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Se=(e,t,r,n)=>(st(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var Ae=(e,t,r)=>(st(e,t,"access private method"),r);import{S as xt,q as er,v as bt,x as tr,y as rr,z as D,A as nr,B as sr,w as re,C as ir,D as or,E as ar,G as lr,p as Ke,e as X,H as lt,u as te,I as Z,J as ur,K as Ot,L as I,M as cr,f as Tt,N as dr,O as fr,P as vr,Q as mr,R as pr,d as dt,c as x,a as b,n as ft,t as ke,T as hr,o as ee,_ as vt,U as ut,V as kt,W as gr,X as yr,Y as ze,Z as Vt,$ as br,m as Or,h as Ne,a0 as we,F as Be,r as it,a1 as Vr,l as St}from"./index-Chzn8YXo.js";import{u as Sr,g as Ar,a as wr}from"./get-product-image.action-BltQ44Z-.js";var oe,ae,q,se,je,We,Re,ct,Nt,Er=(Nt=class extends xt{constructor(t,r){super();pe(this,je);pe(this,Re);pe(this,oe,void 0);pe(this,ae,void 0);pe(this,q,void 0);pe(this,se,void 0);Se(this,oe,t),this.setOptions(r),this.bindMethods(),Ae(this,je,We).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const r=this.options;this.options=P(this,oe).defaultMutationOptions(t),er(this.options,r)||P(this,oe).getMutationCache().notify({type:"observerOptionsUpdated",mutation:P(this,q),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&bt(r.mutationKey)!==bt(this.options.mutationKey)?this.reset():((n=P(this,q))==null?void 0:n.state.status)==="pending"&&P(this,q).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=P(this,q))==null||t.removeObserver(this)}onMutationUpdate(t){Ae(this,je,We).call(this),Ae(this,Re,ct).call(this,t)}getCurrentResult(){return P(this,ae)}reset(){var t;(t=P(this,q))==null||t.removeObserver(this),Se(this,q,void 0),Ae(this,je,We).call(this),Ae(this,Re,ct).call(this)}mutate(t,r){var n;return Se(this,se,r),(n=P(this,q))==null||n.removeObserver(this),Se(this,q,P(this,oe).getMutationCache().build(P(this,oe),this.options)),P(this,q).addObserver(this),P(this,q).execute(t)}},oe=new WeakMap,ae=new WeakMap,q=new WeakMap,se=new WeakMap,je=new WeakSet,We=function(){var r;const t=((r=P(this,q))==null?void 0:r.state)??tr();Se(this,ae,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Re=new WeakSet,ct=function(t){rr.batch(()=>{var r,n,a,o,f,h,u,d;if(P(this,se)&&this.hasListeners()){const y=P(this,ae).variables,S=P(this,ae).context;(t==null?void 0:t.type)==="success"?((n=(r=P(this,se)).onSuccess)==null||n.call(r,t.data,y,S),(o=(a=P(this,se)).onSettled)==null||o.call(a,t.data,null,y,S)):(t==null?void 0:t.type)==="error"&&((h=(f=P(this,se)).onError)==null||h.call(f,t.error,y,S),(d=(u=P(this,se)).onSettled)==null||d.call(u,void 0,t.error,y,S))}this.listeners.forEach(y=>{y(P(this,ae))})})},Nt);function jr(e,t){const r=t||Sr(),n=D(()=>r.defaultMutationOptions(or(e))),a=new Er(r,n.value),o=nr(a.getCurrentResult()),f=a.subscribe(y=>{sr(o,y)}),h=(y,S)=>{a.mutate(y,S).catch(()=>{})};re(n,()=>{a.setOptions(n.value)}),ar(()=>{f()});const d=ir(o);return re(()=>o.error,y=>{if(y&&lr(n.value.throwOnError,[y]))throw y}),{...d,mutate:h,mutateAsync:o.mutate,reset:o.reset}}const Ir=async e=>{if(e==="create")return{id:"",title:"",slug:"",description:"",price:0,stock:0,images:[],tags:[],sizes:[],gender:"",user:{}};try{const{data:t}=await Ke.get(`/products/${e}`);return{...t,images:t.images.map(Ar)}}catch{throw new Error(`Error getting product by id ${e}`)}},Cr=async e=>{const t=e.id,r=await Nr(e.images??[]);return e.images=r,e=_r(e),t&&t!==""?await Fr(t,e):await Pr(e)},_r=e=>{var r;const t=((r=e.images)==null?void 0:r.map(n=>n.startsWith("http")?n.split("/").pop()?n:"":n))??[];return delete e.id,delete e.user,e.images=t,e},Fr=async(e,t)=>{var r;try{const{data:n}=await Ke.patch(`/products/${e}`,t);return n}catch(n){throw console.log((r=n==null?void 0:n.response)==null?void 0:r.data),new Error("Error updating product")}},Pr=async e=>{var t;try{const{data:r}=await Ke.post("/products",e);return r}catch(r){throw console.log((t=r==null?void 0:r.response)==null?void 0:t.data),new Error("Error creating product")}},Nr=async e=>{const t=e.filter(o=>o instanceof File),r=e.filter(o=>typeof o=="string"),n=t.map(async o=>{try{const f=new FormData;f.append("file",o);const{data:h}=await Ke.post("/files/product",f);return h.secureUrl}catch(f){throw console.log(f),new Error("Error uploading image")}}),a=await Promise.all(n);return[...r,...a]};/**
  * vee-validate v4.13.2
  * (c) 2024 Abdelrahman Awad
  * @license MIT
  */function Y(e){return typeof e=="function"}function Ee(e){return e==null}const Ie=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function mt(e){return Number(e)>=0}function Tr(e){return typeof e=="object"&&e!==null}function kr(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function At(e){if(!Tr(e)||kr(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Me(e,t){return Object.keys(t).forEach(r=>{if(At(t[r])&&At(e[r])){e[r]||(e[r]={}),Me(e[r],t[r]);return}e[r]=t[r]}),e}function De(e){const t=e.split(".");if(!t.length)return"";let r=String(t[0]);for(let n=1;n<t.length;n++){if(mt(t[n])){r+=`[${t[n]}]`;continue}r+=`.${t[n]}`}return r}const Mr={};function Rr(e){return Mr[e]}function wt(e,t,r){typeof r.value=="object"&&(r.value=E(r.value)),!r.enumerable||r.get||r.set||!r.configurable||!r.writable||t==="__proto__"?Object.defineProperty(e,t,r):e[t]=r.value}function E(e){if(typeof e!="object")return e;var t=0,r,n,a,o=Object.prototype.toString.call(e);if(o==="[object Object]"?a=Object.create(e.__proto__||null):o==="[object Array]"?a=Array(e.length):o==="[object Set]"?(a=new Set,e.forEach(function(f){a.add(E(f))})):o==="[object Map]"?(a=new Map,e.forEach(function(f,h){a.set(E(h),E(f))})):o==="[object Date]"?a=new Date(+e):o==="[object RegExp]"?a=new RegExp(e.source,e.flags):o==="[object DataView]"?a=new e.constructor(E(e.buffer)):o==="[object ArrayBuffer]"?a=e.slice(0):o.slice(-6)==="Array]"&&(a=new e.constructor(e)),a){for(n=Object.getOwnPropertySymbols(e);t<n.length;t++)wt(a,n[t],Object.getOwnPropertyDescriptor(e,n[t]));for(t=0,n=Object.getOwnPropertyNames(e);t<n.length;t++)Object.hasOwnProperty.call(a,r=n[t])&&a[r]===e[r]||wt(a,r,Object.getOwnPropertyDescriptor(e,r))}return a||e}const Mt=Symbol("vee-validate-form"),Ur=typeof window<"u";function $r(e){return Y(e)&&!!e.__locatorRef}function le(e){return!!e&&Y(e.parse)&&e.__type==="VVTypedSchema"}function Rt(e){return!!e&&Y(e.validate)}function zr(e){return e==="checkbox"||e==="radio"}function Br(e){return Ie(e)||Array.isArray(e)}function Dr(e){return Array.isArray(e)?e.length===0:Ie(e)&&Object.keys(e).length===0}function Ge(e){return/^\[.+\]$/i.test(e)}function Lr(e){return Ut(e)&&e.multiple}function Ut(e){return e.tagName==="SELECT"}function qr(e){return $t(e)&&e.target&&"submit"in e.target}function $t(e){return e?!!(typeof Event<"u"&&Y(Event)&&e instanceof Event||e&&e.srcElement):!1}function ue(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,a;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!ue(e[n],t[n]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;for(n of e.entries())if(!ue(n[1],t.get(n[0])))return!1;return!0}if(Et(e)&&Et(t))return!(e.size!==t.size||e.name!==t.name||e.lastModified!==t.lastModified||e.type!==t.type);if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(n of e.entries())if(!t.has(n[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();for(a=Object.keys(e),r=a.length,n=r;n--!==0;){var o=a[n];if(!ue(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function Et(e){return Ur?e instanceof File:!1}function pt(e){return Ge(e)?e.replace(/\[|\]/gi,""):e}function M(e,t,r){return e?Ge(t)?e[pt(t)]:(t||"").split(/\.|\[(\d+)\]/).filter(Boolean).reduce((a,o)=>Br(a)&&o in a?a[o]:r,e):r}function U(e,t,r){if(Ge(t)){e[pt(t)]=r;return}const n=t.split(/\.|\[(\d+)\]/).filter(Boolean);let a=e;for(let o=0;o<n.length;o++){if(o===n.length-1){a[n[o]]=r;return}(!(n[o]in a)||Ee(a[n[o]]))&&(a[n[o]]=mt(n[o+1])?[]:{}),a=a[n[o]]}}function ot(e,t){if(Array.isArray(e)&&mt(t)){e.splice(Number(t),1);return}Ie(e)&&delete e[t]}function jt(e,t){if(Ge(t)){delete e[pt(t)];return}const r=t.split(/\.|\[(\d+)\]/).filter(Boolean);let n=e;for(let o=0;o<r.length;o++){if(o===r.length-1){ot(n,r[o]);break}if(!(r[o]in n)||Ee(n[r[o]]))break;n=n[r[o]]}const a=r.map((o,f)=>M(e,r.slice(0,f).join(".")));for(let o=a.length-1;o>=0;o--)if(Dr(a[o])){if(o===0){ot(e,r[0]);continue}ot(a[o-1],r[o-1])}}function G(e){return Object.keys(e)}function Wr(e,t=void 0){const r=pr();return(r==null?void 0:r.provides[e])||fr(e,t)}function It(e,t=0){let r=null,n=[];return function(...a){return r&&clearTimeout(r),r=setTimeout(()=>{const o=e(...a);n.forEach(f=>f(o)),n=[]},t),new Promise(o=>n.push(o))}}function Kr(e,t){let r;return async function(...a){const o=e(...a);r=o;const f=await o;return o!==r?f:(r=void 0,t(f,a))}}function Gr({get:e,set:t}){const r=X(E(e()));return re(e,n=>{ue(n,r.value)||(r.value=E(n))},{deep:!0}),re(r,n=>{ue(n,e())||t(E(n))},{deep:!0}),r}function Ct(e){return Array.isArray(e)?e:e?[e]:[]}function Le(e,t){const r={};for(const n in e)t.includes(n)||(r[n]=e[n]);return r}function Hr(e){let t=null,r=[];return function(...n){const a=Z(()=>{if(t!==a)return;const o=e(...n);r.forEach(f=>f(o)),r=[],t=null});return t=a,new Promise(o=>r.push(o))}}function at(e){if(zt(e))return e._value}function zt(e){return"_value"in e}function Xr(e){return e.type==="number"||e.type==="range"?Number.isNaN(e.valueAsNumber)?e.value:e.valueAsNumber:e.value}function _t(e){if(!$t(e))return e;const t=e.target;if(zr(t.type)&&zt(t))return at(t);if(t.type==="file"&&t.files){const r=Array.from(t.files);return t.multiple?r:r[0]}if(Lr(t))return Array.from(t.options).filter(r=>r.selected&&!r.disabled).map(at);if(Ut(t)){const r=Array.from(t.options).find(n=>n.selected);return r?at(r):t.value}return Xr(t)}function Yr(e){const t={};return Object.defineProperty(t,"_$$isNormalized",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e?Ie(e)&&e._$$isNormalized?e:Ie(e)?Object.keys(e).reduce((r,n)=>{const a=Qr(e[n]);return e[n]!==!1&&(r[n]=Ft(a)),r},t):typeof e!="string"?t:e.split("|").reduce((r,n)=>{const a=Jr(n);return a.name&&(r[a.name]=Ft(a.params)),r},t):t}function Qr(e){return e===!0?[]:Array.isArray(e)||Ie(e)?e:[e]}function Ft(e){const t=r=>typeof r=="string"&&r[0]==="@"?Zr(r.slice(1)):r;return Array.isArray(e)?e.map(t):e instanceof RegExp?[e]:Object.keys(e).reduce((r,n)=>(r[n]=t(e[n]),r),{})}const Jr=e=>{let t=[];const r=e.split(":")[0];return e.includes(":")&&(t=e.split(":").slice(1).join(":").split(",")),{name:r,params:t}};function Zr(e){const t=r=>M(r,e)||r[e];return t.__locatorRef=e,t}const xr={generateMessage:({field:e})=>`${e} is not valid.`,bails:!0,validateOnBlur:!0,validateOnChange:!0,validateOnInput:!1,validateOnModelUpdate:!0};let en=Object.assign({},xr);const Te=()=>en;async function tn(e,t,r={}){const n=r==null?void 0:r.bails,a={name:(r==null?void 0:r.name)||"{field}",rules:t,label:r==null?void 0:r.label,bails:n??!0,formData:(r==null?void 0:r.values)||{}},o=await rn(a,e);return Object.assign(Object.assign({},o),{valid:!o.errors.length})}async function rn(e,t){const r=e.rules;if(le(r)||Rt(r))return sn(t,Object.assign(Object.assign({},e),{rules:r}));if(Y(r)||Array.isArray(r)){const h={field:e.label||e.name,name:e.name,label:e.label,form:e.formData,value:t},u=Array.isArray(r)?r:[r],d=u.length,y=[];for(let S=0;S<d;S++){const N=u[S],C=await N(t,h);if(!(typeof C!="string"&&!Array.isArray(C)&&C)){if(Array.isArray(C))y.push(...C);else{const Q=typeof C=="string"?C:Dt(h);y.push(Q)}if(e.bails)return{errors:y}}}return{errors:y}}const n=Object.assign(Object.assign({},e),{rules:Yr(r)}),a=[],o=Object.keys(n.rules),f=o.length;for(let h=0;h<f;h++){const u=o[h],d=await on(n,t,{name:u,params:n.rules[u]});if(d.error&&(a.push(d.error),e.bails))return{errors:a}}return{errors:a}}function nn(e){return!!e&&e.name==="ValidationError"}function Bt(e){return{__type:"VVTypedSchema",async parse(r,n){var a;try{return{output:await e.validate(r,{abortEarly:!1,context:(n==null?void 0:n.formData)||{}}),errors:[]}}catch(o){if(!nn(o))throw o;if(!(!((a=o.inner)===null||a===void 0)&&a.length)&&o.errors.length)return{errors:[{path:o.path,errors:o.errors}]};const f=o.inner.reduce((h,u)=>{const d=u.path||"";return h[d]||(h[d]={errors:[],path:d}),h[d].errors.push(...u.errors),h},{});return{errors:Object.values(f)}}}}}async function sn(e,t){const n=await(le(t.rules)?t.rules:Bt(t.rules)).parse(e,{formData:t.formData}),a=[];for(const o of n.errors)o.errors.length&&a.push(...o.errors);return{value:n.value,errors:a}}async function on(e,t,r){const n=Rr(r.name);if(!n)throw new Error(`No such validator '${r.name}' exists.`);const a=an(r.params,e.formData),o={field:e.label||e.name,name:e.name,label:e.label,value:t,form:e.formData,rule:Object.assign(Object.assign({},r),{params:a})},f=await n(t,a,o);return typeof f=="string"?{error:f}:{error:f?void 0:Dt(o)}}function Dt(e){const t=Te().generateMessage;return t?t(e):"Field is invalid"}function an(e,t){const r=n=>$r(n)?n(t):n;return Array.isArray(e)?e.map(r):Object.keys(e).reduce((n,a)=>(n[a]=r(e[a]),n),{})}async function ln(e,t){const n=await(le(e)?e:Bt(e)).parse(E(t)),a={},o={};for(const f of n.errors){const h=f.errors,u=(f.path||"").replace(/\["(\d+)"\]/g,(d,y)=>`[${y}]`);a[u]={valid:!h.length,errors:h},h.length&&(o[u]=h[0])}return{valid:!n.errors.length,results:a,errors:o,values:n.value,source:"schema"}}async function un(e,t,r){const a=G(e).map(async d=>{var y,S,N;const C=(y=r==null?void 0:r.names)===null||y===void 0?void 0:y[d],W=await tn(M(t,d),e[d],{name:(C==null?void 0:C.name)||d,label:C==null?void 0:C.label,values:t,bails:(N=(S=r==null?void 0:r.bailsMap)===null||S===void 0?void 0:S[d])!==null&&N!==void 0?N:!0});return Object.assign(Object.assign({},W),{path:d})});let o=!0;const f=await Promise.all(a),h={},u={};for(const d of f)h[d.path]={valid:d.valid,errors:d.errors},d.valid||(o=!1,u[d.path]=d.errors[0]);return{valid:o,results:h,errors:u,source:"schema"}}let cn=0;const qe=["bails","fieldsCount","id","multiple","type","validate"];function Lt(e){const t=(e==null?void 0:e.initialValues)||{},r=Object.assign({},I(t)),n=te(e==null?void 0:e.validationSchema);return n&&le(n)&&Y(n.cast)?E(n.cast(r)||{}):E(r)}function dn(e){var t;const r=cn++;let n=0;const a=X(!1),o=X(!1),f=X(0),h=[],u=lt(Lt(e)),d=X([]),y=X({}),S=X({}),N=Hr(()=>{S.value=d.value.reduce((i,s)=>(i[De(I(s.path))]=s,i),{})});function C(i,s){const l=$(i);if(!l){typeof i=="string"&&(y.value[De(i)]=Ct(s));return}if(typeof i=="string"){const c=De(i);y.value[c]&&delete y.value[c]}l.errors=Ct(s),l.valid=!l.errors.length}function W(i){G(i).forEach(s=>{C(s,i[s])})}e!=null&&e.initialErrors&&W(e.initialErrors);const Q=D(()=>{const i=d.value.reduce((s,l)=>(l.errors.length&&(s[l.path]=l.errors),s),{});return Object.assign(Object.assign({},y.value),i)}),ce=D(()=>G(Q.value).reduce((i,s)=>{const l=Q.value[s];return l!=null&&l.length&&(i[s]=l[0]),i},{})),he=D(()=>d.value.reduce((i,s)=>(i[s.path]={name:s.path||"",label:s.label||""},i),{})),Ce=D(()=>d.value.reduce((i,s)=>{var l;return i[s.path]=(l=s.bails)!==null&&l!==void 0?l:!0,i},{})),ge=Object.assign({},(e==null?void 0:e.initialErrors)||{}),ye=(t=e==null?void 0:e.keepValuesOnUnmount)!==null&&t!==void 0?t:!1,{initialValues:v,originalInitialValues:m,setInitialValues:V}=vn(d,u,e),w=fn(d,u,m,ce),j=D(()=>d.value.reduce((i,s)=>{const l=M(u,s.path);return U(i,s.path,l),i},{})),A=e==null?void 0:e.validationSchema;function k(i,s){var l,c;const g=D(()=>M(v.value,I(i))),O=S.value[I(i)],p=(s==null?void 0:s.type)==="checkbox"||(s==null?void 0:s.type)==="radio";if(O&&p){O.multiple=!0;const K=n++;return Array.isArray(O.id)?O.id.push(K):O.id=[O.id,K],O.fieldsCount++,O.__flags.pendingUnmount[K]=!1,O}const F=D(()=>M(u,I(i))),T=I(i),z=fe.findIndex(K=>K===T);z!==-1&&fe.splice(z,1);const _=D(()=>{var K,Pe,et,tt;const rt=I(A);if(le(rt))return(Pe=(K=rt.describe)===null||K===void 0?void 0:K.call(rt,I(i)).required)!==null&&Pe!==void 0?Pe:!1;const nt=I(s==null?void 0:s.schema);return le(nt)&&(tt=(et=nt.describe)===null||et===void 0?void 0:et.call(nt).required)!==null&&tt!==void 0?tt:!1}),B=n++,L=lt({id:B,path:i,touched:!1,pending:!1,valid:!0,validated:!!(!((l=ge[T])===null||l===void 0)&&l.length),required:_,initialValue:g,errors:vr([]),bails:(c=s==null?void 0:s.bails)!==null&&c!==void 0?c:!1,label:s==null?void 0:s.label,type:(s==null?void 0:s.type)||"default",value:F,multiple:!1,__flags:{pendingUnmount:{[B]:!1},pendingReset:!1},fieldsCount:1,validate:s==null?void 0:s.validate,dirty:D(()=>!ue(te(F),te(g)))});return d.value.push(L),S.value[T]=L,N(),ce.value[T]&&!ge[T]&&Z(()=>{me(T,{mode:"silent"})}),Ot(i)&&re(i,K=>{N();const Pe=E(F.value);S.value[K]=L,Z(()=>{U(u,K,Pe)})}),L}const H=It(yt,5),_e=It(yt,5),Ue=Kr(async i=>await(i==="silent"?H():_e()),(i,[s])=>{const l=G(ne.errorBag.value),g=[...new Set([...G(i.results),...d.value.map(O=>O.path),...l])].sort().reduce((O,p)=>{var F;const T=p,z=$(T)||be(T),_=((F=i.results[T])===null||F===void 0?void 0:F.errors)||[],B=I(z==null?void 0:z.path)||T,L=mn({errors:_,valid:!_.length},O.results[B]);return O.results[B]=L,L.valid||(O.errors[B]=L.errors[0]),z&&y.value[B]&&delete y.value[B],z?(z.valid=L.valid,s==="silent"||s==="validated-only"&&!z.validated||C(z,L.errors),O):(C(B,_),O)},{valid:i.valid,results:{},errors:{},source:i.source});return i.values&&(g.values=i.values,g.source=i.source),G(g.results).forEach(O=>{var p;const F=$(O);F&&s!=="silent"&&(s==="validated-only"&&!F.validated||C(F,(p=g.results[O])===null||p===void 0?void 0:p.errors))}),g});function de(i){d.value.forEach(i)}function $(i){const s=typeof i=="string"?De(i):i;return typeof s=="string"?S.value[s]:s}function be(i){return d.value.filter(l=>i.startsWith(l.path)).reduce((l,c)=>l?c.path.length>l.path.length?c:l:c,void 0)}let fe=[],Oe;function He(i){return fe.push(i),Oe||(Oe=Z(()=>{[...fe].sort().reverse().forEach(l=>{jt(u,l)}),fe=[],Oe=null})),Oe}function R(i){return function(l,c){return function(O){return O instanceof Event&&(O.preventDefault(),O.stopPropagation()),de(p=>p.touched=!0),a.value=!0,f.value++,Ve().then(p=>{const F=E(u);if(p.valid&&typeof l=="function"){const T=E(j.value);let z=i?T:F;return p.values&&(z=p.source==="schema"?p.values:Object.assign({},z,p.values)),l(z,{evt:O,controlledValues:T,setErrors:W,setFieldError:C,setTouched:Qe,setFieldTouched:$e,setValues:Xe,setFieldValue:ie,resetForm:Je,resetField:ht})}!p.valid&&typeof c=="function"&&c({values:F,evt:O,errors:p.errors,results:p.results})}).then(p=>(a.value=!1,p),p=>{throw a.value=!1,p})}}}const J=R(!1);J.withControlled=R(!0);function Fe(i,s){const l=d.value.findIndex(g=>g.path===i&&(Array.isArray(g.id)?g.id.includes(s):g.id===s)),c=d.value[l];if(!(l===-1||!c)){if(Z(()=>{me(i,{mode:"silent",warn:!1})}),c.multiple&&c.fieldsCount&&c.fieldsCount--,Array.isArray(c.id)){const g=c.id.indexOf(s);g>=0&&c.id.splice(g,1),delete c.__flags.pendingUnmount[s]}(!c.multiple||c.fieldsCount<=0)&&(d.value.splice(l,1),gt(i),N(),delete S.value[i])}}function qt(i){G(S.value).forEach(s=>{s.startsWith(i)&&delete S.value[s]}),d.value=d.value.filter(s=>!s.path.startsWith(i)),Z(()=>{N()})}const ne={formId:r,values:u,controlledValues:j,errorBag:Q,errors:ce,schema:A,submitCount:f,meta:w,isSubmitting:a,isValidating:o,fieldArrays:h,keepValuesOnUnmount:ye,validateSchema:te(A)?Ue:void 0,validate:Ve,setFieldError:C,validateField:me,setFieldValue:ie,setValues:Xe,setErrors:W,setFieldTouched:$e,setTouched:Qe,resetForm:Je,resetField:ht,handleSubmit:J,useFieldModel:Qt,defineInputBinds:Jt,defineComponentBinds:Zt,defineField:xe,stageInitialValue:Xt,unsetInitialValue:gt,setFieldInitialValue:Ze,createPathState:k,getPathState:$,unsetPathValue:He,removePathState:Fe,initialValues:v,getAllPathStates:()=>d.value,destroyPath:qt,isFieldTouched:Kt,isFieldDirty:Gt,isFieldValid:Ht};function ie(i,s,l=!0){const c=E(s),g=typeof i=="string"?i:i.path;$(g)||k(g),U(u,g,c),l&&me(g)}function Wt(i,s=!0){G(u).forEach(l=>{delete u[l]}),G(i).forEach(l=>{ie(l,i[l],!1)}),s&&Ve()}function Xe(i,s=!0){Me(u,i),h.forEach(l=>l&&l.reset()),s&&Ve()}function Ye(i,s){const l=$(I(i))||k(i);return D({get(){return l.value},set(c){var g;const O=I(i);ie(O,c,(g=I(s))!==null&&g!==void 0?g:!1)}})}function $e(i,s){const l=$(i);l&&(l.touched=s)}function Kt(i){const s=$(i);return s?s.touched:d.value.filter(l=>l.path.startsWith(i)).some(l=>l.touched)}function Gt(i){const s=$(i);return s?s.dirty:d.value.filter(l=>l.path.startsWith(i)).some(l=>l.dirty)}function Ht(i){const s=$(i);return s?s.valid:d.value.filter(l=>l.path.startsWith(i)).every(l=>l.valid)}function Qe(i){if(typeof i=="boolean"){de(s=>{s.touched=i});return}G(i).forEach(s=>{$e(s,!!i[s])})}function ht(i,s){var l;const c=s&&"value"in s?s.value:M(v.value,i),g=$(i);g&&(g.__flags.pendingReset=!0),Ze(i,E(c),!0),ie(i,c,!1),$e(i,(l=s==null?void 0:s.touched)!==null&&l!==void 0?l:!1),C(i,(s==null?void 0:s.errors)||[]),Z(()=>{g&&(g.__flags.pendingReset=!1)})}function Je(i,s){let l=E(i!=null&&i.values?i.values:m.value);l=s!=null&&s.force?l:Me(m.value,l),l=le(A)&&Y(A.cast)?A.cast(l):l,V(l,{force:s==null?void 0:s.force}),de(c=>{var g;c.__flags.pendingReset=!0,c.validated=!1,c.touched=((g=i==null?void 0:i.touched)===null||g===void 0?void 0:g[c.path])||!1,ie(c.path,M(l,c.path),!1),C(c.path,void 0)}),s!=null&&s.force?Wt(l,!1):Xe(l,!1),W((i==null?void 0:i.errors)||{}),f.value=(i==null?void 0:i.submitCount)||0,Z(()=>{Ve({mode:"silent"}),de(c=>{c.__flags.pendingReset=!1})})}async function Ve(i){const s=(i==null?void 0:i.mode)||"force";if(s==="force"&&de(p=>p.validated=!0),ne.validateSchema)return ne.validateSchema(s);o.value=!0;const l=await Promise.all(d.value.map(p=>p.validate?p.validate(i).then(F=>({key:p.path,valid:F.valid,errors:F.errors,value:F.value})):Promise.resolve({key:p.path,valid:!0,errors:[],value:void 0})));o.value=!1;const c={},g={},O={};for(const p of l)c[p.key]={valid:p.valid,errors:p.errors},p.value&&U(O,p.key,p.value),p.errors.length&&(g[p.key]=p.errors[0]);return{valid:l.every(p=>p.valid),results:c,errors:g,values:O,source:"fields"}}async function me(i,s){var l;const c=$(i);if(c&&(s==null?void 0:s.mode)!=="silent"&&(c.validated=!0),A){const{results:g}=await Ue((s==null?void 0:s.mode)||"validated-only");return g[i]||{errors:[],valid:!0}}return c!=null&&c.validate?c.validate(s):(!c&&(l=s==null?void 0:s.warn),Promise.resolve({errors:[],valid:!0}))}function gt(i){jt(v.value,i)}function Xt(i,s,l=!1){Ze(i,s),U(u,i,s),l&&!(e!=null&&e.initialValues)&&U(m.value,i,E(s))}function Ze(i,s,l=!1){U(v.value,i,E(s)),l&&U(m.value,i,E(s))}async function yt(){const i=te(A);if(!i)return{valid:!0,results:{},errors:{},source:"none"};o.value=!0;const s=Rt(i)||le(i)?await ln(i,u):await un(i,u,{names:he.value,bailsMap:Ce.value});return o.value=!1,s}const Yt=J((i,{evt:s})=>{qr(s)&&s.target.submit()});ur(()=>{if(e!=null&&e.initialErrors&&W(e.initialErrors),e!=null&&e.initialTouched&&Qe(e.initialTouched),e!=null&&e.validateOnMount){Ve();return}ne.validateSchema&&ne.validateSchema("silent")}),Ot(A)&&re(A,()=>{var i;(i=ne.validateSchema)===null||i===void 0||i.call(ne,"validated-only")}),mr(Mt,ne);function xe(i,s){const l=Y(s)||s==null?void 0:s.label,c=$(I(i))||k(i,{label:l}),g=()=>Y(s)?s(Le(c,qe)):s||{};function O(){var _;c.touched=!0,((_=g().validateOnBlur)!==null&&_!==void 0?_:Te().validateOnBlur)&&me(c.path)}function p(){var _;((_=g().validateOnInput)!==null&&_!==void 0?_:Te().validateOnInput)&&Z(()=>{me(c.path)})}function F(){var _;((_=g().validateOnChange)!==null&&_!==void 0?_:Te().validateOnChange)&&Z(()=>{me(c.path)})}const T=D(()=>{const _={onChange:F,onInput:p,onBlur:O};return Y(s)?Object.assign(Object.assign({},_),s(Le(c,qe)).props||{}):s!=null&&s.props?Object.assign(Object.assign({},_),s.props(Le(c,qe))):_});return[Ye(i,()=>{var _,B,L;return(L=(_=g().validateOnModelUpdate)!==null&&_!==void 0?_:(B=Te())===null||B===void 0?void 0:B.validateOnModelUpdate)!==null&&L!==void 0?L:!0}),T]}function Qt(i){return Array.isArray(i)?i.map(s=>Ye(s,!0)):Ye(i)}function Jt(i,s){const[l,c]=xe(i,s);function g(){c.value.onBlur()}function O(F){const T=_t(F);ie(I(i),T,!1),c.value.onInput()}function p(F){const T=_t(F);ie(I(i),T,!1),c.value.onChange()}return D(()=>Object.assign(Object.assign({},c.value),{onBlur:g,onInput:O,onChange:p,value:l.value}))}function Zt(i,s){const[l,c]=xe(i,s),g=$(I(i));function O(p){l.value=p}return D(()=>{const p=Y(s)?s(Le(g,qe)):s||{};return Object.assign({[p.model||"modelValue"]:l.value,[`onUpdate:${p.model||"modelValue"}`]:O},c.value)})}return Object.assign(Object.assign({},ne),{values:cr(u),handleReset:()=>Je(),submitForm:Yt})}function fn(e,t,r,n){const a={touched:"some",pending:"some",valid:"every"},o=D(()=>!ue(t,te(r)));function f(){const u=e.value;return G(a).reduce((d,y)=>{const S=a[y];return d[y]=u[S](N=>N[y]),d},{})}const h=lt(f());return Tt(()=>{const u=f();h.touched=u.touched,h.valid=u.valid,h.pending=u.pending}),D(()=>Object.assign(Object.assign({initialValues:te(r)},h),{valid:h.valid&&!G(n.value).length,dirty:o.value}))}function vn(e,t,r){const n=Lt(r),a=X(n),o=X(E(n));function f(h,u){u!=null&&u.force?(a.value=E(h),o.value=E(h)):(a.value=Me(E(a.value)||{},E(h)),o.value=Me(E(o.value)||{},E(h))),u!=null&&u.updateFields&&e.value.forEach(d=>{if(d.touched)return;const S=M(a.value,d.path);U(t,d.path,E(S))})}return{initialValues:a,originalInitialValues:o,setInitialValues:f}}function mn(e,t){return t?{valid:e.valid&&t.valid,errors:[...e.errors,...t.errors]}:e}function Pt(e){const t=Wr(Mt,void 0),r=X([]),n=()=>{},a={fields:r,remove:n,push:n,swap:n,insert:n,update:n,replace:n,prepend:n,move:n};if(!t||!te(e))return a;const o=t.fieldArrays.find(v=>te(v.path)===te(e));if(o)return o;let f=0;function h(){return M(t==null?void 0:t.values,I(e),[])||[]}function u(){const v=h();Array.isArray(v)&&(r.value=v.map((m,V)=>y(m,V,r.value)),d())}u();function d(){const v=r.value.length;for(let m=0;m<v;m++){const V=r.value[m];V.isFirst=m===0,V.isLast=m===v-1}}function y(v,m,V){if(V&&!Ee(m)&&V[m])return V[m];const w=f++;return{key:w,value:Gr({get(){const A=M(t==null?void 0:t.values,I(e),[])||[],k=r.value.findIndex(H=>H.key===w);return k===-1?v:A[k]},set(A){const k=r.value.findIndex(H=>H.key===w);k!==-1&&he(k,A)}}),isFirst:!1,isLast:!1}}function S(){d(),t==null||t.validate({mode:"silent"})}function N(v){const m=I(e),V=M(t==null?void 0:t.values,m);if(!V||!Array.isArray(V))return;const w=[...V];w.splice(v,1);const j=m+`[${v}]`;t.destroyPath(j),t.unsetInitialValue(j),U(t.values,m,w),r.value.splice(v,1),S()}function C(v){const m=E(v),V=I(e),w=M(t==null?void 0:t.values,V),j=Ee(w)?[]:w;if(!Array.isArray(j))return;const A=[...j];A.push(m),t.stageInitialValue(V+`[${A.length-1}]`,m),U(t.values,V,A),r.value.push(y(m)),S()}function W(v,m){const V=I(e),w=M(t==null?void 0:t.values,V);if(!Array.isArray(w)||!(v in w)||!(m in w))return;const j=[...w],A=[...r.value],k=j[v];j[v]=j[m],j[m]=k;const H=A[v];A[v]=A[m],A[m]=H,U(t.values,V,j),r.value=A,d()}function Q(v,m){const V=E(m),w=I(e),j=M(t==null?void 0:t.values,w);if(!Array.isArray(j)||j.length<v)return;const A=[...j],k=[...r.value];A.splice(v,0,V),k.splice(v,0,y(V)),U(t.values,w,A),r.value=k,S()}function ce(v){const m=I(e);t.stageInitialValue(m,v),U(t.values,m,v),u(),S()}function he(v,m){const V=I(e),w=M(t==null?void 0:t.values,V);!Array.isArray(w)||w.length-1<v||(U(t.values,`${V}[${v}]`,m),t==null||t.validate({mode:"validated-only"}))}function Ce(v){const m=E(v),V=I(e),w=M(t==null?void 0:t.values,V),j=Ee(w)?[]:w;if(!Array.isArray(j))return;const A=[m,...j];U(t.values,V,A),t.stageInitialValue(V+"[0]",m),r.value.unshift(y(m)),S()}function ge(v,m){const V=I(e),w=M(t==null?void 0:t.values,V),j=Ee(w)?[]:[...w];if(!Array.isArray(w)||!(v in w)||!(m in w))return;const A=[...r.value],k=A[v];A.splice(v,1),A.splice(m,0,k);const H=j[v];j.splice(v,1),j.splice(m,0,H),U(t.values,V,j),r.value=A,S()}const ye={fields:r,remove:N,push:C,swap:W,insert:Q,update:he,replace:ce,prepend:Ce,move:ge};return t.fieldArrays.push(Object.assign({path:e,reset:u},ye)),dr(()=>{const v=t.fieldArrays.findIndex(m=>I(m.path)===I(e));v>=0&&t.fieldArrays.splice(v,1)}),re(h,v=>{const m=r.value.map(V=>V.value);ue(v,m)||u()}),ye}const pn=["type","value"],hn={key:0,class:"text-red-400"},gn=dt({__name:"CustomInput",props:{modelValue:{},error:{},type:{default:"text"}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(ee(),x("div",null,[b("input",{type:t.type,value:t.modelValue,onInput:r[0]||(r[0]=n=>{var a;return t.$emit("update:modelValue",((a=n.target)==null?void 0:a.value)??"")}),onBlur:r[1]||(r[1]=n=>t.$emit("blur")),class:ft(["form-control",{"border-red-500":t.error}])},null,42,pn),t.error?(ee(),x("span",hn,ke(t.error),1)):hr("",!0)]))}}),yn=vt(gn,[["__scopeId","data-v-9fd06dc0"]]),bn=["type","value"],On=dt({__name:"CustomTextArea",props:{modelValue:{},error:{},type:{default:"text"}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(ee(),x("div",null,[b("textarea",{type:t.type,value:t.modelValue,onInput:r[0]||(r[0]=n=>{var a;return t.$emit("update:modelValue",((a=n.target)==null?void 0:a.value)??"")}),onBlur:r[1]||(r[1]=n=>t.$emit("blur")),class:ft(["form-control",{"border-red-500":t.error}])},null,42,bn),ut(b("span",{class:"text-red-400"},ke(t.error),513),[[kt,t.error]])]))}}),Vn=vt(On,[["__scopeId","data-v-d8fc4721"]]),Sn=yr({title:ze().required("Este campo es super importante").min(3,"Mínimo de 3 letras!!!"),slug:ze().required(),description:ze().required(),price:Vt().required(),stock:Vt().required().min(1),gender:ze().required().oneOf(["men","women","kid"])}),An=dt({components:{CustomInput:yn,CustomTextArea:Vn},props:{productId:{type:String,required:!0}},setup(e){const t=br(),r=gr(),{data:n,isError:a,isLoading:o,refetch:f}=wr({queryKey:["product",e.productId],queryFn:()=>Ir(e.productId),retry:!1}),{mutate:h,isPending:u,isSuccess:d,data:y}=jr({mutationFn:Cr}),{values:S,defineField:N,errors:C,handleSubmit:W,resetForm:Q,meta:ce}=dn({validationSchema:Sn}),[he,Ce]=N("title"),[ge,ye]=N("slug"),[v,m]=N("description"),[V,w]=N("price"),[j,A]=N("stock"),[k,H]=N("gender"),{fields:_e,remove:Ue,push:de}=Pt("sizes"),{fields:$}=Pt("images"),be=X([]),fe=W(async R=>{console.log("onSubmit Llamado");const ve={...R,images:[...R.images,...be.value]};h(ve)}),Oe=R=>{const ve=_e.value.map(Fe=>Fe.value);ve.includes(R)?Ue(ve.indexOf(R)):de(R)},He=R=>{const J=R.target.files;if(J&&J.length!==0)for(const Fe of J)be.value.push(Fe)};return Tt(()=>{if(a.value&&!o.value){t.replace("/admin/products");return}}),re(n,()=>{n&&Q({values:n.value})},{deep:!0,immediate:!0}),re(d,R=>{R&&(r.success("Producto actualizado correctamente"),t.replace(`/admin/products/${y.value.id}`),Q({values:y.value}),be.value=[])}),re(()=>e.productId,()=>{f()}),{values:S,errors:C,meta:ce,title:he,titleAttrs:Ce,slug:ge,slugAttrs:ye,description:v,descriptionAttrs:m,price:V,priceAttrs:w,stock:j,stockAttrs:A,gender:k,genderAttrs:H,sizes:_e,images:$,imageFiles:be,onFileChanged:He,isPending:u,allSizes:["XS","S","M","L","XL","XXL"],onSubmit:fe,toggleSize:Oe,hasSize:R=>_e.value.map(J=>J.value).includes(R),temporalImageUrl:R=>URL.createObjectURL(R)}}}),wn={class:"bg-white px-5 py-2 rounded"},En={class:"text-3xl"},jn={class:"text-blue-500"},In={class:"first-col"},Cn={class:"mb-4"},_n={class:"mb-4"},Fn={class:"mb-4"},Pn={class:"flex flex-row gap-3"},Nn={class:"mb-4 flex-1"},Tn={class:"mb-4 flex-1"},kn={class:"mb-4"},Mn={class:"flex"},Rn=["onClick"],Un={class:"first-col"},$n={class:"flex p-2 overflow-x-auto space-x-8 w-full h-[265px] bg-gray-200 rounded"},zn=["src","alt"],Bn=["src"],Dn={class:"col-span-2 my-2"},Ln={class:"mb-4"},qn={class:"my-4 text-right"},Wn=["disabled"];function Kn(e,t,r,n,a,o){const f=St("CustomInput"),h=St("CustomTextArea");return ee(),x(Be,null,[b("div",wn,[b("h1",En,[t[8]||(t[8]=Or(" Producto: ")),b("small",jn,ke(e.title),1)]),t[9]||(t[9]=b("hr",{class:"my-4"},null,-1))]),b("form",{onSubmit:t[7]||(t[7]=(...u)=>e.onSubmit&&e.onSubmit(...u)),class:"grid grid-cols-1 sm:grid-cols-2 bg-white px-5 gap-5"},[b("div",In,[b("div",Cn,[t[10]||(t[10]=b("label",{for:"title",class:"form-label"},"Título",-1)),Ne(f,we({modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=u=>e.title=u)},e.titleAttrs,{error:e.errors.title}),null,16,["modelValue","error"])]),b("div",_n,[t[11]||(t[11]=b("label",{for:"slug",class:"form-label"},"Slug",-1)),Ne(f,we({modelValue:e.slug,"onUpdate:modelValue":t[1]||(t[1]=u=>e.slug=u)},e.slugAttrs,{error:e.errors.slug}),null,16,["modelValue","error"])]),b("div",Fn,[t[12]||(t[12]=b("label",{for:"description",class:"form-label"},"Descripción",-1)),Ne(h,we({modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=u=>e.description=u)},e.descriptionAttrs,{error:e.errors.description}),null,16,["modelValue","error"])]),b("div",Pn,[b("div",Nn,[t[13]||(t[13]=b("label",{for:"price",class:"form-label"},"Precio",-1)),Ne(f,we({modelValue:e.price,"onUpdate:modelValue":t[3]||(t[3]=u=>e.price=u),modelModifiers:{number:!0}},e.priceAttrs,{error:e.errors.price}),null,16,["modelValue","error"])]),b("div",Tn,[t[14]||(t[14]=b("label",{for:"stock",class:"form-label"},"Inventario",-1)),Ne(f,we({modelValue:e.stock,"onUpdate:modelValue":t[4]||(t[4]=u=>e.stock=u),modelModifiers:{number:!0}},e.stockAttrs,{error:e.errors.stock}),null,16,["modelValue","error"])])]),b("div",kn,[t[15]||(t[15]=b("label",{for:"sizes",class:"form-label"},"Tallas",-1)),b("div",Mn,[(ee(!0),x(Be,null,it(e.allSizes,u=>(ee(),x("button",{key:u,onClick:d=>e.toggleSize(u),type:"button",class:ft(["p-2 rounded w-14 mr-2 flex-1",{"bg-blue-500 text-white":e.hasSize(u),"bg-blue-100":!e.hasSize(u)}])},ke(u),11,Rn))),128))])])]),b("div",Un,[t[19]||(t[19]=b("label",{for:"stock",class:"form-label"},"Imágenes",-1)),b("div",$n,[(ee(!0),x(Be,null,it(e.images,u=>(ee(),x("div",{key:u.value,class:"flex-shrink-0"},[b("img",{src:u.value,alt:e.title,class:"w-[250px] h-[250px] rounded"},null,8,zn)]))),128)),(ee(!0),x(Be,null,it(e.imageFiles,u=>(ee(),x("div",{key:u.name,class:"flex-shrink-0"},[b("img",{src:e.temporalImageUrl(u),class:"w-[250px] h-[250px] rounded"},null,8,Bn)]))),128))]),b("div",Dn,[t[16]||(t[16]=b("label",{for:"image",class:"form-label"},"Subir imagen",-1)),b("input",{multiple:"",type:"file",id:"image",class:"form-control",accept:"image/*",onChange:t[5]||(t[5]=(...u)=>e.onFileChanged&&e.onFileChanged(...u))},null,32)]),b("div",Ln,[t[18]||(t[18]=b("label",{for:"stock",class:"form-label"},"Género",-1)),ut(b("select",we({"onUpdate:modelValue":t[6]||(t[6]=u=>e.gender=u)},e.genderAttrs,{class:"form-control"}),t[17]||(t[17]=[b("option",{value:""},"Seleccione",-1),b("option",{value:"kid"},"Niño",-1),b("option",{value:"women"},"Mujer",-1),b("option",{value:"men"},"Hombre",-1)]),16),[[Vr,e.gender]]),ut(b("span",{class:"text-red-400"},ke(e.errors.gender),513),[[kt,e.errors.gender]])]),b("div",qn,[b("button",{disabled:e.isPending,type:"submit",class:"disabled:bg-gray-300 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," Guardar ",8,Wn)])])],32)],64)}const Yn=vt(An,[["render",Kn],["__scopeId","data-v-0fa52cf4"]]);export{Yn as default};
